using UnityEngine;
using System.Collections;
using UnityEngine.UI;

public class Sistema_Guardado_Experiencia : Photon.MonoBehaviour

{
    public static int Balas;
    public static int Vida;

	public static int Mana_Magia;
	public static int Materiales;
	public static int Puntos_De_Experiencia;
	public static int Nivel_Jugador;

	public GameObject Lista_de_Botones;



	public bool localPlayer = false;

	public Text textoMagia;//////////////////////////////Mostrar Estado Mana Magia
	public Text textoPuntos_De_Experiencia;//////////////////////////////Mostrar Puntos de Experiencia
	public Text textoNivel_Jugador;//////////////////////////////Mostrar Nivel del Jugador
	public Text textoMateriales;//////////////////////////////Mostrar Nivel del Jugador

	public GameObject Posicion_Pistola;



     void Start () {
		
		Vida += 10;
		Balas += 1;
		Materiales += 1;
		Nivel_Jugador += 1;





		Lista_de_Botones.SetActive (false);
		///////////////////////////////////////////////////////////////////////Vida Inicial del Jugador
		if (Nivel_Jugador == 0) 

		{
			Vida = 100;

		}
       

		if (Nivel_Jugador >= 1) 

		{
			Vida = 100;

		}




        ///////////////////////////////////////////////////////////////////////////
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		///////////////////////////////////////////////////////////////////////Nivel Inicial del Jugador
		if (Puntos_De_Experiencia == 0) 

		{
			Nivel_Jugador = 1;

		}


		if (Puntos_De_Experiencia >= 1) 

		{
			Nivel_Jugador = 1;

		}
		///////////////////////////////////////////////////////////////////////////

        
		/////////////////////////////////////////////////////////////////////////////////////////////////////////
        if (PlayerPrefs.HasKey("balas"))//load money
			Balas = PlayerPrefs.GetInt("balas");
		else if (Balas == 0)

		/////////////////////////////////////////////////////////////////////////////////////////////////////////////

		//////////////////////////////////////////////////////////////////////////////////////////////////////////////
        if (PlayerPrefs.HasKey("vida"))//load levels
			Vida = PlayerPrefs.GetInt("vida");
		
		/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////







		//////////////////////////1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
		if (PlayerPrefs.HasKey("materiales"))//load money
			Materiales = PlayerPrefs.GetInt("materiales");
		else if (Materiales == 0)

		{
			return;

		}
		///////////////////////////2222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
       
		////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		if (PlayerPrefs.HasKey("Experiencia"))//load money
			Puntos_De_Experiencia = PlayerPrefs.GetInt("Experiencia");
		else if (Puntos_De_Experiencia == 0)

		{
			return;

		}
		////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

		///////////////////////////33333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333
		if (PlayerPrefs.HasKey("Magia"))//Guardar Datos Magia
			Mana_Magia = PlayerPrefs.GetInt("Magia");
		else if (Mana_Magia == 0)

		{
			return;

		}
		/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

		/////////////////////////44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
		if (PlayerPrefs.HasKey("Nivel"))//Guardar Datos Magia
			Nivel_Jugador = PlayerPrefs.GetInt("Nivel");
		else if (Nivel_Jugador == 0)

		{
			return;

		}
		/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



		textoMagia.GetComponent<Text>().text = Mana_Magia.ToString();//Mostrar Estado Magia
		textoPuntos_De_Experiencia.GetComponent<Text>().text = Puntos_De_Experiencia.ToString();//Mostrar Estado Experiencia
		textoNivel_Jugador.GetComponent<Text>().text = Nivel_Jugador.ToString();//Mostrar Estado Nivel Jugador
		textoMateriales.GetComponent<Text>().text = Materiales.ToString();//Mostrar Estado Materiales 
	
	
	}







	/////////////////////////SISTEMA DE Guardado de Datos///////////////////////////////////////////////////////////////////

	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	public void Guardar_balas() ///////////////////////////////Guardar Datos Balas

	{

		PlayerPrefs.SetInt("balas", Balas);//Guardar Datos Player Prefs

	}
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	public void Guardar_vida() ///////////////////////////////Guardar Datos Vida

	{

		PlayerPrefs.SetInt("vida", Vida);//Guardar Datos Player Prefs

	}
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////




	//////xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

	//////xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	public void Guardar_Materiales() ///////////////////////////////Guardar Datos Magia//////11111111111111111111111111111111

	{

		PlayerPrefs.SetInt("materiales", Materiales);//Guardar Datos Player Prefs
		textoMateriales.GetComponent<Text>().text = Materiales.ToString();//Mostrar Estado Materiales 

	}
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	public void Guardar_Experiencia() ///////////////////////////////Guardar Datos Magia//////22222222222222222222222222222

	{

		PlayerPrefs.SetInt("Experiencia", Puntos_De_Experiencia);//Guardar Datos Player Prefs
		textoPuntos_De_Experiencia.GetComponent<Text>().text = Puntos_De_Experiencia.ToString();//Mostrar Estado Experiencia


	}
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	public void Guardar_Magia() ///////////////////////////////Guardar Datos Magia//////3333333333333333333333333333333333

	{

		PlayerPrefs.SetInt("Magia", Mana_Magia);//Guardar Datos Player Prefs
		textoMagia.GetComponent<Text>().text = Mana_Magia.ToString();//Mostrar Estado Magia

	
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	public void Guardar_Nivel() ///////////////////////////////Guardar Datos Magia//////4444444444444444444444444444444444

	{

		PlayerPrefs.SetInt("Nivel", Nivel_Jugador);//Guardar Datos Player Prefs
		textoNivel_Jugador.GetComponent<Text>().text = Nivel_Jugador.ToString();//Mostrar Estado Nivel Jugador

	}
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////






	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	public void Borrar_vida() ///////////////////////////////Borrar Datos

	{
		PlayerPrefs.DeleteKey("vida");
		Vida = 0;
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	public void Borrar_Balas() ///////////////////////////////Borrar Datos

	{
		PlayerPrefs.DeleteKey("balas");
		Balas = 0;
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


	//////*****************************************************************************************************************
	/// Borrar los Estados del Jugador con Fines de Testeo y Pruebas
	/// 
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	public void Borrar_Materiales() ///////////////////////////////Borrar Datos

	{
		PlayerPrefs.DeleteKey("materiales");
		Materiales = 0;
		textoMateriales.GetComponent<Text>().text = Materiales.ToString();//Mostrar Estado Materiales 
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	public void Borrar_Experiencia() ///////////////////////////////Borrar Datos

	{
		PlayerPrefs.DeleteKey("Experiencia");
		Puntos_De_Experiencia = 0;
		textoPuntos_De_Experiencia.GetComponent<Text>().text = Puntos_De_Experiencia.ToString();//Mostrar Estado Experiencia

	}
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	public void Borrar_Magia() ///////////////////////////////Borrar Datos

	{
		PlayerPrefs.DeleteKey("Magia");
		Mana_Magia = 0;
		textoMagia.GetComponent<Text>().text = Mana_Magia.ToString();//Mostrar Estado Magia

	}
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	public void Borrar_Nivel() ///////////////////////////////Borrar Datos

	{
		PlayerPrefs.DeleteKey("Nivel");
		Nivel_Jugador = 0;
		textoNivel_Jugador.GetComponent<Text>().text = Nivel_Jugador.ToString();//Mostrar Estado Nivel Jugador

	}
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////












	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	public void NumeroAzar() {

		////numeroPuntaje =  Random.Range(100,101);
		////BALAS += 10;

	}
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////






	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	public void Mostrar_Estados()/////////////////////////Solo el Jugador Local vea su Panel de Experiencia Independiente
	{
		// Este es nuestro Propio Jugador
		if (photonView.isMine)
		{
			localPlayer = true;
		{
			Lista_de_Botones.SetActive (true);
			
			
			
			
		}
		}
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	public void Ocultar_Estados()/////////////////////////////////////////////Ocultar Panel de Experiencia
	{
		// Este es nuestro Propio Jugador
		if (photonView.isMine)
		{
			localPlayer = true;
			{
				Lista_de_Botones.SetActive (false);

			}
		}
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////





	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	public void Actualizar_Magia()////////////////////Funcion Muestra el Estado  Actual del Jugador
	{
		// Este es nuestro Propio Jugador
		if (photonView.isMine)
		{
			localPlayer = true;
			{
				Lista_de_Botones.SetActive (true);
				textoMagia.text = Mana_Magia.ToString();
			}
		}
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	public void Actualizar_Experiencia()
	{
		// Este es nuestro Propio Jugador
		if (photonView.isMine)
		{
			localPlayer = true;
			{
				Lista_de_Botones.SetActive (true);
				textoPuntos_De_Experiencia.text = Puntos_De_Experiencia.ToString();
			}
		}
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////




	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	public void Actualizar_Nivel()
	{
		// Este es nuestro Propio Jugador
		if (photonView.isMine)
		{
			localPlayer = true;
			{
				Lista_de_Botones.SetActive (true);
				textoNivel_Jugador.text = Nivel_Jugador.ToString();
			}
		}
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////




	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	public void Actualizar_Materiales()
	{
		// Este es nuestro Propio Jugador
		if (photonView.isMine)
		{
			localPlayer = true;
			{
				Lista_de_Botones.SetActive (true);
				textoMateriales.text = Materiales.ToString();
			}
		}
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////









	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	void Update () {
		





		if (Balas <= 0)
				
			{
			  
			Balas = -1;
			return;

			}







		
	}

	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	/// //////////////////////////////////////////////////////////////////Mostrar Vida
	/// </summary>
	void OnGUI()
	{

		// Este es nuestro Propio Jugador
		if (photonView.isMine)
		{
			if (localPlayer)
			{

				GUI.skin.label.fontSize = 35;
				GUI.color = Color.black;
				GUILayout.Label("Vida_" + Vida);
				GUILayout.Label("\nBalas_" + Balas);
			}

		}


		// Este es el otro Jugador
		else if (!photonView.isMine)
		{            
			//name += msg.sender.name; 

			localPlayer = false;
			return;
			////Panel_de_Puntos.SetActive (false);


		}


	}



	/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	void OnPhotonInstantiate(PhotonMessageInfo msg)
	{
		// Este es nuestro Propio Jugador
		if (photonView.isMine)
		{
			localPlayer = true;
			Lista_de_Botones.SetActive (true);

		}


		// Este es el otro Jugador
		else if (!photonView.isMine)
		{            
			//name += msg.sender.name; 

			localPlayer = false;
			Lista_de_Botones.SetActive (false);


		}

	}
	////////////////////////////////////////////////////////////////////////////////////////////////////////////
	/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////




	/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	void OnTriggerStay(Collider other)
	{



		// Este es nuestro Propio Jugador
		if (photonView.isMine)
		{
			if (localPlayer)////////////Si somos el Jugador Local
			{


				/////////////////////////////////////////////////////////////////////////////////////////////////////
				if(other.CompareTag("Daño"))
				{
					Vida -= 1;

					if(Vida <= 0)
					{
						////Destroy(gameObject);
						//Destroy(Instantiate(explosion, transform.position, Quaternion.identity), 1.2f);
						GameObject[] spawnpoints = GameObject.FindGameObjectsWithTag("Spawnpoint1");
						Transform spawnpoint = spawnpoints[Random.Range(0, spawnpoints.Length)].transform;

						transform.position = spawnpoint.position;
						transform.rotation = spawnpoint.rotation;
						Vida = 100;
			 ///////////////////////////////////////////////////////////////////////////////////
					}
				}
			
			
			
			
			}

		}










		/// Este es nuestro Propio Jugador
		if (photonView.isMine)
		{
			if (localPlayer)
			{


				/////////////////////////////////////////////////////////////////////////////////////////////////////
				if(other.CompareTag("Balas"))
				{
					Balas += 1;
					///Debug.Log("Bala Añadida");

					if(Balas <= 0)
					{

					}
				}
				/////////////////////////////////////////////////////////////////////////////////////////////////////




			}

		}





		/// Este es nuestro Propio Jugador
		if (photonView.isMine)
		{
			if (localPlayer)
			{


				/////////////////////////////////////////////////////////////////////////////////////////////////////
				if (other.gameObject.name.Contains("Vida"))//money bonus
				{

					////Destroy(other.gameObject);//destruir el objeto de la bala
					Sistema_Guardado_Experiencia.Vida += 1;//reward
					Debug.Log("Vida Obtenida");
				}
				/////////////////////////////////////////////////////////////////////////////////////////////////////




			}

		}






		/// Este es nuestro Propio Jugador
		if (photonView.isMine)
		{
			if (localPlayer)
			{


				/////////////////////////////////////////////////////////////////////////////////////////////////////
				if (other.gameObject.name.Contains("Municion"))//money bonus
				{

					////Destroy(other.gameObject);//destruir el objeto de la bala
					Sistema_Guardado_Experiencia.Balas += 1;//reward
					Debug.Log("Dinero Obtenido");
				}
				/////////////////////////////////////////////////////////////////////////////////////////////////////




			}

		}


	






		/// Este es nuestro Propio Jugador
		if (photonView.isMine)
		{
			if (localPlayer)
			{


				/////////////////////////////////////////////////////////////////////////////////////////////////////
				if(other.CompareTag("Guardar_Balas"))////////////////// Guardar Numero de Balas
				{


					{
						//Destroy(gameObject);
						PlayerPrefs.SetInt("balas", Sistema_Guardado_Experiencia.Balas);//SAVE money ON DEATH
						//Application.LoadLevel(0);//load menu
					}
				}
				/////////////////////////////////////////////////////////////////////////////////////////////////////




			}

		}
		///////////////////////////////////////////////////////////////////////////////////////////////////////////////////





		/// Este es nuestro Propio Jugador
		if (photonView.isMine)
		{
			if (localPlayer)
			{


				/////////////////////////////////////////////////////////////////////////////////////////////////////
				if (other.gameObject.name.Contains("Magia"))//Subir Magia
				{

					////Destroy(other.gameObject);//destruir el objeto de la bala
					Sistema_Guardado_Experiencia.Mana_Magia += 1;//reward
					Debug.Log("Vida Obtenida");
				}
				/////////////////////////////////////////////////////////////////////////////////////////////////////




			}

		}
		////////////////////////////////////////////////////////////////////////////////////////////////////////////////











		/// Este es nuestro Propio Jugador
		if (photonView.isMine)
		{
			if (localPlayer)
			{


				/////////////////////////////////////////////////////////////////////////////////////////////////////
				if(other.CompareTag("Exp"))////////////////// Subir Experiencia
				{


					{
						Sistema_Guardado_Experiencia.Puntos_De_Experiencia += 1;//reward
						Debug.Log("Exp Obtenida");
					}
				}
				/////////////////////////////////////////////////////////////////////////////////////////////////////




			}

		}
		///////////////////////////////////////////////////////////////////////////////////////////////////////////////////









		/// Este es nuestro Propio Jugador
		if (photonView.isMine)
		{
			if (localPlayer)
			{


				/////////////////////////////////////////////////////////////////////////////////////////////////////
				if(other.CompareTag("Nivel"))////////////////// Subir Nivel
				{


					{
						Sistema_Guardado_Experiencia.Nivel_Jugador += 1;//reward
						Debug.Log("Nivel Obtenido");
					}
				}
				/////////////////////////////////////////////////////////////////////////////////////////////////////




			}

		}
		///////////////////////////////////////////////////////////////////////////////////////////////////////////////////







		/// Este es nuestro Propio Jugador
		if (photonView.isMine)
		{
			if (localPlayer)
			{


				/////////////////////////////////////////////////////////////////////////////////////////////////////
				if(other.CompareTag("Materiales"))////////////////// Subir Materiales
				{


					{
						Sistema_Guardado_Experiencia.Materiales += 1;//reward
						Debug.Log("Material Obtenido");
					
					}
				}
				/////////////////////////////////////////////////////////////////////////////////////////////////////




			}

		}
		///////////////////////////////////////////////////////////////////////////////////////////////////////////////////





		/// Este es nuestro Propio Jugador
		if (photonView.isMine)
		{
			if (localPlayer)
			{


				/////////////////////////////////////////////////////////////////////////////////////////////////////
				if(other.CompareTag("Testeo"))////////////////// Subir Materiales
				{


					{
					///////////////Ponemos los valores que queramos Testear.	

					}
				}
				/////////////////////////////////////////////////////////////////////////////////////////////////////




			}

		}
		///////////////////////////////////////////////////////////////////////////////////////////////////////////////////




















	}

	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////













	}
